if(!("undefined"!=typeof window&&"harden"in window&&"EventEmitter"in window&&"async"in window&&"heredito"in window))var harden=require("harden"),EventEmitter=require("wolfy87-eventemitter"),async=require("async"),heredito=require("heredito");if("undefined"!=typeof window&&!("harden"in window))throw new Error("harden is not defined");if("undefined"!=typeof window&&!("EventEmitter"in window))throw new Error("EventEmitter is not defined");if("undefined"!=typeof window&&!("async"in window))throw new Error("async is not defined");if("undefined"!=typeof window&&!("heredito"in window))throw new Error("heredito is not defined");var Edo=function n(){return this instanceof n?void 0:new n};heredito(Edo,EventEmitter),Edo.prototype.on=function(n,e){return Array.isArray(n)?async.parallel(n.map(function(n){return function(e){EventEmitter.prototype.on.call(this,n,function(){e.apply(this,arguments)}.bind(this))}.bind(this)}.bind(this)),function(){e.apply(this,arguments)}.bind(this)):EventEmitter.prototype.on.call(this,n,e),this},Edo.prototype.emit=function(n){var e={count:1e3},t=arguments;return async.until(function(){return this.getListeners(n).length>0||0==--e.count}.bind(this),function i(n){i.timeout=setTimeout(function(){n(),clearTimeout(i.timeout)},i.count)},function(){e.count||this.getListeners(n).length>0?EventEmitter.prototype.emit.apply(this,t):console.debug("event emit failed",t)}.bind(this)),this},"undefined"!=typeof module&&(module.exports=Edo),"undefined"!=typeof global&&harden.bind(Edo)("globalize",function(){harden.bind(global)("Edo",Edo)});